language: scala
env:
  - TEST_TASK=scalajs-test/test
script:
  - sbt "${SBT_SETUP}" package testing/test $TEST_TASK
after_success:
  - if [[ "${PUBLISH_ENABLED}" == "true" && "${TRAVIS_PULL_REQUEST}" == "false" && "${TRAVIS_BRANCH}" == "master" && "${PUBLISH_USER}" != "" && "${PUBLISH_PASS}" != "" ]]; then sbt publish; fi
  - if [[ "${PUBLISH_ENABLED}" == "true" && "${TRAVIS_PULL_REQUEST}" == "false" && "${TRAVIS_BRANCH}" == "scala-2.11" && "${PUBLISH_USER}" != "" && "${PUBLISH_PASS}" != "" ]]; then sbt scalajs-compiler/publish scalajs-library/publish scalajs-jasmine-test-framework; fi
scala:
  - 2.11.0-M7
jdk:
  - oraclejdk7
  - openjdk7
matrix:
  include:
    - jdk: openjdk6
      env:
        - PUBLISH_ENABLED=true
        - secure: "gIReAZ60hLtbYTlnNUM508LhhznImVPRO5fHQ/9SY7mqA/ql3EVJ65M43GxzvKjNkZ7thKj1ygYklCQaqXwdszR8xRRM7MNQIUImZhsjXJ0xqorpQf2fmo2sD54Gx/caAI4kx0x/ULm9ZA5QK6hprl8aVqb1o5bYAxfZdx719pE="
        - secure: "CiwH9VZ0Wl/fGsL6XUbXv92TWr+EnX94ICX2cbwwkvPDxmTrdWf8BZOq7JSrfITYvvW3l5U8YWLjCMpa/Cr2C2BD1QPvNXDoeL9cZXA0I2yquQNEfh12Zg5c5bHRtO+CeRHjq06jjEqojqTzp5MK10YXnfzzQFiZ1lt7c/rwmkU="
    - jdk: openjdk6
      env:
        - SBT_SETUP='set scalacOptions in ScalaJSBuild.test += "-Xexperimental"' TEST_TASK=scalajs-test/test
    - jdk: openjdk6
      env:
        - TEST_TASK=scalajs-partest-suite/test
  allow_failures:
    - env:
        - TEST_TASK=scalajs-partest-suite/test
  fast_finish: true
